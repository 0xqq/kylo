/*
Defines the following structure and node types:

    "metadata"
        "feeds"
            category*
                feed*
                    feedSource*
                    feedDestination*
        "datasources"
            datasource
        "generic"
            "types"
                genericType
            "entities"
                genericEntity
*/

<tba = 'http://thinkbiganalytics.com/metadata'>

//// Tree structure /////

[tba:metadataFolder]
    + feeds (tba:feedsFolder) = tba:feedsFolder mandatory autocreated
    + datasources (tba:datasourcesFolder) = tba:datasourcesFolder mandatory autocreated
    + generic (tba:genericFolder) = tba:genericFolder mandatory autocreated

[tba:feedsFolder] > nt:folder
    + category (tba:categoryFolder) = tba:categoryFolder mandatory autocreated

[tba:genericFolder] > nt:folder
    + types (tba:typesFolder) = tba:typesFolder mandatory autocreated
    + entities (tba:entitiesFolder) = tba:entitiesFolder mandatory autocreated

[tba:datasourcesFolder] > nt:folder

[tba:categoryFolder] > nt:folder

[tba:typesFolder] > nt:folder

[tba:entitiesFolder] > nt:folder


//// Predefined Entities ////

[tba:propertied]
    + properties mandatory

[tba:entity] > nt:hierarchyNode, mix:lastModified

[tba:genericEntity] > tba:entity

[tba:feed] > tba:entity, tba:propertied, mix:title, mix:referenceable
    - systemName (String) mandatory
    - state (Long)
    - initialized (Boolean) = false
    + sources (tba:feedSource) sns
    + destinations (tba:feedDestination) sns
//    - preconditon (tba:feedPrecondition)


[tba:feedConnection] > tba:entity, mix:referenceable
    - datasource (weakreference) mandatory

[tba:feedSource] > tba:feedConnection

[tba:feedDestination] > tba:feedConnection
//  + fieldPolicies (tba:fieldPolicy) sns

[tba:datasource] > tba:entity, tba:propertied, mix:title, mix:referenceable
    + feedSources (tba:feedSource) sns
    + feedDestinations (tba:feedDestination) sns

