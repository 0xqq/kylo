<!--
  ~ Copyright (c) 2015.
  -->
<card-layout flex header-css="filter-header">
    <header-section tba-card-filter-header flex layout card-title="vm.cardTitle" page-name="{{vm.pageName}}" view-type="vm.viewType" sort-options="vm.sortOptions" on-selected-option="vm.selectedTableOption" filter-model="vm.filter">

    </header-section>
<body-section>
    <md-tabs   flex md-selected="vm.tabMetadata.selectedIndex"
               md-align-tabs="top" layout-fill  md-dynamic-height>

        <md-tab ng-repeat="tab in vm.tabs"
                ng-disabled="tab.disabled"
                md-on-select="vm.onTabSelected(tab)" flex
                >
            <md-tab-label> {{tab.title}} </md-tab-label>
            <md-tab-body>
                <md-divider></md-divider>
            <div ng-hide="vm.viewType != 'list'" ng-show="vm.viewType == 'list'">
                <md-list flex layout-fill class="list-item-table">
                    <md-list-item  class="md-secondary" dir-paginate="feed in tab.data.content|orderBy:vm.paginationData.sort |filter:vm.filter|itemsPerPage:vm.paginationData.rowsPerPage" pagination-id="vm.paginationId(tab)"  ng-click="vm.feedDetails($event,feed)">
                           <div layout="row" layout-fill>
                           <div flex="30" layout="column" class="item-column md-list-item-text ">
                                     <span class="item-title" title="{{feed.feed}}">
                                       {{feed.feed}}
                                   </span>
                                    <span  ng-class="{'healthy':feed.healthText == 'HEALTHY','error':feed.healthText == 'UNHEALTHY'}" class="column-title-bottom">
                                           <ng-md-icon icon="{{feed.icon}}" size="20" hide-xs >
                                           </ng-md-icon>   {{feed.healthText}}</span>

                            </div>
                            <div flex="20" layout="column" class="item-column md-list-item-text ">

                                   <span  class="item-title-small {{feed.statusStyle}}" >
                                     {{feed.displayStatus}}</span>
                                     <span class="column-title column-title-bottom">
                                     Status
                                   </span>
                            </div>
                            <div flex="30" layout="column" class="item-column md-list-item-text ">
                                   <span class="item-title"><tba-timer start-time="feed.timeSinceEndTime"></tba-timer>
                                   </span>
                                <span class="column-title column-title-bottom">Since</span>
                            </div>
                            <div flex hide-xs layout="column" class="item-column md-list-item-text ">
                                <span class="item-title">{{feed.runTimeString}}</span>
                                <span class="column-title column-title-bottom">Last Run Time</span>
                            </div>
                           </div>
                       <md-divider ng-if="!$last"></md-divider>
                    </md-list-item>
                    <md-list-item  ng-show="vm.loading == false && tab.content.length ==0">
                        No results found
                    </md-list-item >
                    <md-divider></md-divider>
                    <md-list-item   layout-align="end center"  layout-row class="pagination-list-item">
                        <dir-pagination-controls pagination-id="vm.paginationId(tab)"
                                                 auto-hide="false"
                                                 max-size="5"
                                                 direction-links="true"
                                                 boundary-links="false"
                                                 template-url="js/vendor/dirPagination/dirPagination.tpl.html"
                                                 current-page="vm.currentPage(tab)"
                                                 on-page-change="vm.onPaginationChange(newPageNumber)"
                                                 label="Rows per page"
                                                 rows-per-page="vm.paginationData.rowsPerPage"
                                                 rows-per-page-options="vm.paginationData.rowsPerPageOptions"
                                                 class="pagination-row">
                        </dir-pagination-controls>
                    </md-list-item>
                </md-list>
            </div>
            <div ng-hide="vm.viewType != 'table'" ng-show="vm.viewType == 'table'">
                <md-table-container>
                    <table md-table md-progress="vm.deferred.promise">
                        <thead md-head md-order="vm.paginationData.sort" md-on-reorder="vm.onOrderChange" >
                        <tr md-row>
                            <th md-column name="Feed" order-by="feed">Feed</th>
                            <th md-column name="Health" order-by="healthText">Health</th>
                            <th md-column name="Status" order-by="displayStatus">Status</th>
                            <th md-column name="Since" order-by="timeSinceEndTime" >Since</th>
                            <th md-column name="Last Run Time" order-by="runTime">Last Run Time</th>
                        </tr>
                        </thead>
                        <tbody md-body>
                        <tr md-row ng-repeat="feed in tab.data.content | orderBy: vm.paginationData.sort | filter:vm.filter | limitTo: vm.paginationData.rowsPerPage: (tab.currentPage - 1) * vm.paginationData.rowsPerPage"  ng-click="vm.feedDetails($event,feed)">
                        <td md-cell>{{feed.feed}}</td>
                        <td md-cell>
                                    <span  ng-class="{'healthy':feed.healthText == 'HEALTHY','unhealthy':feed.healthText == 'UNHEALTHY'}">
                                       <ng-md-icon icon="{{feed.icon}}" size="20"
                                                   style="{{job.iconstyle}}">
                                       </ng-md-icon>
                                       <span>{{feed.healthText}}</span></span>

                        </td>
                        <td md-cell>
                                       <span class="{{feed.statusStyle}}">
                                         {{feed.displayStatus}}
                                       </span>
                        </td>
                        <td md-cell ><tba-timer start-time="feed.timeSinceEndTime"></tba-timer></td>
                        <td md-cell>{{feed.runTimeString}}</td>
                        </tr>
                        </tbody>
                    </table>
                </md-table-container>

                <md-table-pagination md-limit="vm.paginationData.rowsPerPage" md-page="tab.currentPage" md-total="{{tab.data.content.length}}" md-on-paginate="vm.onPaginationChange" md-limit-options="[5,10,20,50,'ALL']"></md-table-pagination>

            </div>


            <div ng-show="vm.loading == true">
                <md-progress-circular md-mode="indeterminate" md-diameter="25px"></md-progress-circular>
            </div>
                </md-tab-body>
        </md-tab>
    </md-tabs>

</body-section>
    </card-layout>
